<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
  "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<!-- revision 9449 -->

<sect1 id="ch-bootable-grub" role="wrap">
  <?dbhtml filename="grub.html"?>

  <sect1info condition="script">
    <productname>grub</productname> 
    <productnumber>&grub-version;</productnumber> 
    <address>&grub-url;</address> 
  </sect1info>

  <!--<title>Using GRUB to Set Up the Boot Process</title>-->
  <title>GRUBを使用してブートプロセスをセットアップする</title>

  <sect2>
    <!--<title>Introduction</title>-->
    <title>イントロダクション</title>

    <para>Boot loading can be a complex area, so a few cautionary
    words are in order. Be familiar with the current boot loader and any other
    operating systems present on the hard drive(s) that need to be
    bootable. Make sure that an emergency boot disk is ready to
    <quote>rescue</quote> the computer if the computer becomes
    unusable (un-bootable).</para>
    <para>ブートローディングは複雑な領域です。ですので、いくつかの注意事項が整理されています。
    現在使用しているブートローダーと、HDDに同居しているブート可能にする必要のある他のオペレーティングシステムについて、理解を深めておいてください。
    コンピュータが使用不可能(ブート不能)に陥った場合に備え、コンピュータを<quote>レスキュー</quote>するための緊急用ブートディスクが準備されていることを確認してください。</para>

    <para>The procedure involves writing some special GRUB files to specific
    locations on the hard drive. We highly recommend creating a GRUB boot
    floppy diskette as a backup. Insert a blank floppy diskette and run the
    following commands:</para>
    <para>手順としては、ハードドライブ上の特定の位置に、GRUBのいくつかの特別なファイルを作成する必要があります。
    バックアップとして、GRUBのブートフロッピーを作成することを強くお勧めします。
    空のフロッピーディスクをドライブに挿入し、次のコマンドを実行してください：</para>

<screen role="nodump"><userinput>cd /tmp
grub-mkrescue --output=grub-img.iso
dd if=grub-img.iso of=/dev/fd0 bs=1440 count=1</userinput></screen>

    <para>Alternatively, a boot CD can be created by using your host system's 
    CD burning tools to burn the <filename>grub-img.iso</filename> on to a 
    blank CD.</para>
    <para>別の方法としては、ホストシステムのCD作成ツールを用いて<filename>grub-img.iso</filename>をブランクCDに書き込むことで、ブートCDを作成することが出来ます。</para>

    <para>GRUB uses its own naming structure for drives and partitions in
    the form of <emphasis>(hdn,m)</emphasis>, where <emphasis>n</emphasis>
    is the hard drive number and <emphasis>m</emphasis> is the partition
    number. The hard drive number starts from zero, but the partition number
    starts from one for normal partitions and five for extended partitions.
    Note that this is different from earlier versions where
    both numbers started from zero. For example, partition <filename
    class="partition">sda1</filename> is <emphasis>(hd0,1)</emphasis> to
    GRUB and <filename class="partition">sdb3</filename> is
    <emphasis>(hd1,3)</emphasis>. In contrast to Linux, GRUB does not
    consider CD-ROM drives to be hard drives. For example, if using a CD
    on <filename class="partition">hdb</filename> and a second hard drive
    on <filename class="partition">hdc</filename>, that second hard drive
    would still be <emphasis>(hd1)</emphasis>.</para>
    <para>GRUBは、ドライブとパーティションについて、<emphasis>(hdn,m)</emphasis>の形式の独自の命名構造を使います。
    <emphasis>n</emphasis>はハードドライブの番号を示し、<emphasis>m</emphasis>はパーティションの番号を示します。
    ハードドライブの番号は0から始まりますが、パーティションの番号は1から始まり、それは基本パーティションです。パーティション番号5は拡張パーティションとなります。
    以前のバージョンではドライブ番号もパーティション番号も0から始まっていましたが、新バージョンでは異なることに留意してください。
    例えば、パーティション<filename class="partition">sda1</filename>は<emphasis>(hd0,1)</emphasis>、<filename class="partition">sdb3</filename>は<emphasis>(hd1,3)</emphasis>となります。
    Linuxとは対照的に、GRUBはCD-ROMドライブをハードドライブとはみなしません。
    例えば、もしCDが<filename class="partition">hdb</filename>で、2つ目のハードドライブが<filename class="partition">hdc</filename>だとすると、2つ目のハードドライブは<emphasis>(hd1)</emphasis>となります。
    </para>

    <para>You can determine what GRUB thinks your disk devices are by running:</para> 
    <para>GRUBがあなたのディスクデバイスをどのように認識しているか、次のコマンドを実行することで確認することができます：</para>

<screen role="nodump"><userinput>grub-mkdevicemap --device-map=device.map
cat device.map</userinput></screen> 
 
    <para>The location of the boot partition is a choice of the user that 
    affects the configuration.  One recommendation is to have a separate small 
    (suggested size is 100 MB) partition just for boot information.  That way 
    each build, whether LFS or some commercial distro, can access the same boot 
    files and access can be made from any booted system.  If you choose to do 
    this, you will need to mount the separate partition, move all files in the 
    current <filename class="directory">/boot</filename> directory (e.g. the 
    linux kernel you just built in the previous section) to the new partition. 
    You will then need to unmount the partition and remount it as <filename 
    class="directory">/boot</filename>.  If you do this, be sure to update 
    <filename>/etc/fstab</filename>.</para>
    <para>ブートパーティションの位置はユーザーが選択し、設定に影響を与えます。
    おすすめの一つは、ブートの情報のためだけの独立した小さなパーティション(推奨サイズは100MB)を用意することです。
    そんなふうに、LFSであろうがいくつかの商用ディストロであろうが、それぞれのビルドが同じブートファイルにアクセスすることが出来、ブートされたシステムであればアクセスすることが出来ます。
    もし上記のやり方を選択する場合、独立したパーティションをマウントし、現在の<filename class="directory">/boot</filename>ディレクトリのファイルすべて(例：前セクションでちょうどビルドしたLinux Kernel)を新しいパーティションに移動する必要があります。
    それからパーティションをアンマウントし、<filename class="directory">/boot</filename>としてマウントしなおす必要があります。
    また、確実に<filename>/etc/fstab</filename>を更新するようにしてください。</para> 
 
    <para>Using the current lfs partition will also work, but configuration 
    for multiple systems is more difficult.</para>
    <para>現在のlfsパーティションを使用してもうまくいきますが、複数のシステムの設定はより難しいです。</para> 
  </sect2> 
 
  <sect2> 
    <!--<title>Setting Up the Configuration</title>-->
    <title>設定</title>

    <para>Using the above information, determine the appropriate
    designator for the root partition (or boot partition, if a separate
    one is used). For the following example, it is assumed that the root
    (or separate boot) partition is <filename
    class="partition">sda2</filename>.</para>
    <para>上記情報を使用して、rootパーティション(別のパーティションを使用する場合はbootパーティション)の適切な指定を決定してください。
    次の例の場合、root(または別のboot)パーティションは<filename class="partition">sda2</filename>と推測されます。</para>

    <para>Install the GRUB files into <filename
    class="directory">/boot/grub</filename>:</para>
    <para><filename class="directory">/boot/grub</filename>にGRUBのファイルをインストールします：</para>

<screen role="nodump"><userinput>grub-install --grub-setup=/bin/true /dev/sda</userinput></screen>

    <para>We use --grub-setup=/bin/true for now to prevent updating the  
    Master Boot Record (MBR).  In this way, we can test our installation  
    before committing to a change that is hard to revert.</para> 
    <para>マスターブートレコード(MBR)の更新を防ぐため、現時点では--grub-setup=/bin/trueを指定します。
    元の状態に戻すのが困難になる変更の確定前に、この方法でインストールをテストすることができます。</para>
 
    <para>Generate <filename>/boot/grub/grub.cfg</filename>:</para> 
    <para><filename>/boot/grub/grub.cfg</filename>を生成します：</para>
 
<screen role="nodump"><userinput>grub-mkconfig -o /boot/grub/grub.cfg</userinput></screen> 
 
    <para>Here <command>grub-mkconfig</command> uses the files in <filename 
    class="directory">/etc/grub.d/</filename> to determine the contents 
    of this file. The configuration file will look something like:</para> 
    <para>ここで<command>grub-mkconfig</command>は、このファイルの内容を確定するため、<filename class="directory">/etc/grub.d/</filename>内のファイルを使用します。設定ファイルは次のような内容になるでしょう：</para>

<screen><computeroutput># 
# DO NOT EDIT THIS FILE 
#
# It is automatically generated by /usr/sbin/grub-mkconfig using templates 
# from /etc/grub.d and settings from /etc/default/grub 
# 
 
### BEGIN /etc/grub.d/00_header ### 
set default=0 
set timeout=5 
### END /etc/grub.d/00_header ### 
 
### BEGIN /etc/grub.d/10_linux ###
menuentry "GNU/Linux, Linux &linux-version;-lfs-&version;" {
        insmod ext2
        set root=(hd0,2)
        search --no-floppy --fs-uuid --set 915852a7-859e-45a6-9ff0-d3ebfdb5cea2
        linux   /boot/vmlinux-&linux-version;-lfs-&version; root=/dev/sda2 ro
}
menuentry "GNU/Linux, Linux &linux-version;-lfs-&version;" (recovery mode)" {
        insmod ext2
        set root=(hd0,2)
        search --no-floppy --fs-uuid --set 915852a7-859e-45a6-9ff0-d3ebfdb5cea2
        linux   /boot/vmlinux-&linux-version;-lfs-&version; root=/dev/sda2 ro single
}
menuentry "GNU/Linux, Linux 2.6.28-11-server" {
        insmod ext2
        set root=(hd0,2)
        search --no-floppy --fs-uuid --set 6b4c0339-5501-4a85-8351-e398e5252be8
        linux   /boot/vmlinuz-2.6.28-11-server \
                root=UUID=6b4c0339-5501-4a85-8351-e398e5252be8 ro
        initrd  /boot/initrd.img-2.6.28-11-server
}
menuentry "GNU/Linux, Linux 2.6.28-11-server (recovery mode)" {
        insmod ext2
        set root=(hd0,2)
        search --no-floppy --fs-uuid --set 6b4c0339-5501-4a85-8351-e398e5252be8
        linux   /boot/vmlinuz-2.6.28-11-server \
                root=UUID=6b4c0339-5501-4a85-8351-e398e5252be8 ro single
        initrd  /boot/initrd.img-2.6.28-11-server
} 
### END /etc/grub.d/10_linux ###
 
### BEGIN /etc/grub.d/30_os-prober ### 
### END /etc/grub.d/30_os-prober ### 
 
### BEGIN /etc/grub.d/40_custom ### 
# This file provides an easy way to add custom menu entries.  Simply type the 
# menu entries you want to add after this comment.  Be careful not to change 
# the 'exec tail' line above. 
### END /etc/grub.d/40_custom ### 
</computeroutput></screen> 
 
  <para>Note that even though there is a warning not to edit the file, you can 
  do so as long as you do not re-run <command>grub-mkconfig</command>.  The 
  <emphasis>search</emphasis> lines are not meaningful for LFS systems as that 
  command needs an initrd image for processing. If installing on a separate 
  partition the linux and initrd lines will not have the /boot on the file 
  names.  In this example the kernel files for a Ubuntu installation are 
  also found in <filename class="directory">/boot</filename>.</para> 
  <para>ファイルを編集しないでくださいという警告がありますが、<command>grub-mkconfig</command>コマンドをリランしない限り、編集することが出来ます。
  <emphasis>search</emphasis>の行は、処理するinitrdイメージが必要なので、LFSシステムにとっては意味がありません。
  もし独立した/bootパーティションにインストールする場合、linuxとinitrdの行はファイル名に/bootを含みません。
  Ubuntuのインストールであるこの例において、カーネルファイルは<filename class="directory">/boot</filename>にあります。</para>

  <note>
  <itemizedlist>
      <listitem><para>Even though there is a warning not to edit the file, you
      can do so as long as you do not re-run
      <command>grub-mkconfig</command>.</para>
      <para>ファイルを編集しないでくださいという警告がありますが、<command>grub-mkconfig</command>コマンドをリランしない限り、編集することが出来ます。</para></listitem>

      <listitem><para>The <emphasis>search</emphasis> lines are generally not
      useful for LFS systems as that command only sets an internal GRUB 
      variable used to find the kernel image.  The <emphasis>set root</emphasis>  
      command provides the same capability without the overhead of  
      searching.</para>
      <para><emphasis>search</emphasis>は一般的に、LFSシステムにとっては便利なものではありません。
      このコマンドはカーネルイメージを見つけるために使われる、GRUB内部の変数をセットするだけのコマンドだからです。
      <emphasis>set root</emphasis>コマンドはカーネルイメージを探すオーバーヘッドなしに、同様の機能を提供します。</para></listitem>

      <listitem><para>The <emphasis>set root</emphasis> and  
      <emphasis>insmod ext2</emphasis> commands can be moved out of the   
      <emphasis>menuentry</emphasis> sections to apply to all sections of the file. 
      This leads to a simple section like:</para>
      <para><emphasis>set root</emphasis>と<emphasis>insmod ext2</emphasis>コマンドは、ファイル中の全てのセクションに適用するために、<emphasis>menuentry</emphasis>セクションの外に出すことが出来ます。
      そうすることで次のようにシンプルなセクションとなります：</para></listitem>
 
      </itemizedlist> 
<screen><computeroutput>menuentry "Linux &linux-version;-lfs-&version;" { 
linux   /boot/vmlinux-&linux-version;-lfs-&version; root=/dev/sda2 ro 
} 
</computeroutput></screen>

  <itemizedlist> 
 
      <listitem><para>Passing a UUID to the kernel requires an initial ram disk 
      (initrd) not built by LFS.</para>
      <para>カーネルにUUIDを渡す場合はinitrd(initial ram disk)が必要となります。
      このinitrdはLFSではビルドしません。</para></listitem> 
   
      <listitem><para>If the <filename>/boot</filename> partition is installed 
      on a separate partition, the linux and initrd lines should not have the 
      string <emphasis>/boot</emphasis> prefixed to the file 
      names.</para>
      <para>もし<filename>/boot</filename>パーティションが個別のパーティションにインストールされている場合、linuxとinitrd行の値の先頭に、文字列<emphasis>/boot</emphasis>は含まれないはずです。</para></listitem>  
   
      <listitem><para>In this example the kernel files for a Ubuntu 
      installation are also found in <filename 
      class="directory">/boot</filename>.</para>
      <para>上のサンプルでは、Ubuntuのカーネルファイルも<filename class="directory">/boot</filename>に存在しています。</para></listitem> 
 
   </itemizedlist> 
   </note>
 
  </sect2> 
    
  <sect2> 
     <!--<title>Testing the Configuration</title>-->
     <title>設定のテスト</title>

     <para>The core image of GRUB is also a Multiboot kernel, so if you already 
     have <emphasis>GRUB Legacy</emphasis> loaded you can load
     GRUB-&grub-version; through your old boot loader.  To accomplish this, you
     will need to exit the <command>chroot</command> environment now and
     re-enter it in the next section to finish the few remaining portions of
     the book.</para> 
     <para>GRUBのコアイメージはマルチブートのカーネルで、もしすでに<emphasis>GRUB Legacy</emphasis>がロードされているならば、その古いブートローダーを通してGRUB-&grub-version;をロードすることが出来ます。
     これを実現するには、すぐに<command>chroot</command>環境を抜け、次のセクションで再度<command>chroot</command>環境に入り直し、本書の残りの部分を行う必要があります</para>
 
<screen role="nodump"><userinput>/sbin/reboot 
... 
grub> root (hd0,1) 
grub> kernel /boot/grub/core.img 
grub> boot</userinput></screen> 
 
     <para>Note that the GRUB commands above are assumed to be GRUB Legacy. 
     At this point the GRUB prompt will appear (very similar to GRUB Legacy) and 
     you can explore the interface or boot to one of the systems in the grub.cfg  
     file.</para> 
     <para>上記のGRUBコマンドはGRUB Legacyを想定していることに注意してください。
     この時点でGRUBのプロンプトが現れ(GRUB Legacyにとても似ています)、インタフェースを探索したりgrub.cfgファイルに記述されたシステムの一つをブートすることが出来ます。</para>  
   </sect2> 
 
  <sect2> 
     <!--<title>Updating the Master Boot Record</title>-->
     <title>マスターブートレコードの更新</title>
 
     <para>If you tested the GRUB configuration as specified above, re-enter 
     the <command>chroot</command> environment.</para> 
     <para>上で明記した通りGRUBの設定をテストしたのであれば、<command>chroot</command>環境に再度入ります。</para>

    <warning>
      <para>The following command will overwrite the current boot loader. Do not
      run the command if this is not desired, for example, if using a third party
      boot manager to manage the Master Boot Record (MBR).</para>
      <para>次のコマンドは現在使用しているブートローダーを上書きします。
      もし上書きを望まないのであれば(例えばサードパーティのブートマネージャーでMBR(Master Boot Record)を管理している場合)、コマンドを実行しないでください。</para>
    </warning>

    <para>Update the MBR with:</para>
    <para>次のとおりMBRを更新します：</para>

<screen role="nodump"><userinput>grub-setup '&lt;DEVICE&gt;'</userinput></screen>

    <para>Change the DEVICE above to your boot disk, normally '(hd0)' or /dev/sda.   
    If using (hd0) be sure to escape the parentheses with backslashes or single 
    quotes to prevent the shell from interpreting them as a sub-shell.</para>
    <para>上記DEVICEをあなたのブートディスクのデバイス名に変えてください。
    通常は'(hd0)'か/dev/sdaになります。
    もし(hd0)を使用する場合、必ずバックスラッシュでカッコをエスケープするか、シングルクォートで囲んでシェルがサブシェルだと解釈しないようにしてください。</para>

    <para>This program uses the following defaults and are correct if you did not
    deviate from the instructions above:</para>
    <para>このプログラムは次のデフォルトを使用します。
    もしあなたが上記手順からそれていないのであれば、以下の値になります。</para>

    <itemizedlist>
      <listitem><para>boot image  - boot.img  </para></listitem>
      <listitem><para>core image  - core.img  </para></listitem>
      <listitem><para>directory   - /boot/grub</para></listitem>
      <listitem><para>device map  - device.map</para></listitem>
      <listitem><para>default root setting - guessed</para></listitem>
    </itemizedlist>

   <note><para>The root setting is the default value if a 'set root' 
   instruction is not found in grub.cfg.  This is the partition that is 
   searched for the kernel and other supporting files.  It is different from 
   the 'root=' parameter on the 'linux' line in the configuration line.  The 
   latter is the partition the kernel mounts as '/'.  In the example grub.cfg 
   above, both values point to /dev/sda2, but if there is a separate boot 
   partition, they will be different.</para>
   <para>grub.cfgに'set root'の指定がなければ、rootの設定値はデフォルトの値が使用されます。
   この設定値はカーネルとその他サポートファイルを探すパーティンションとなります。
   この設定は、'linux'の行の'root="パラメータとは異なります。
   後者はカーネルが'/'としてマウントするパーティションを指定します。
   上記grub.cfgの例では、両方の値は/dev/sda2を指定していますが、もし独立したbootパーティションが存在するならば、それらの設定値は異なります。</para></note>
   </sect2>

</sect1>
